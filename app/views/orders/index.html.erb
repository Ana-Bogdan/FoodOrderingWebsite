<% content_for :title, "Eureka Caffe - Admin Orders" %>

<% content_for :hero_content do %>
  <%= render 'shared/hero', title: 'Admin Orders Dashboard', description: 'Manage and track all customer orders.' %>
<% end %>

<div class="orders-container">
  <% if @orders.any? %>
    <div class="orders-list">
      <% @orders.each do |order| %>
        <div class="order-item <%= 'completed' if order.completed? %>">
          <div class="order-header">
            <div class="order-info">
              <h3>Order #<%= order.id %></h3>
              <div class="order-meta">
                <span class="customer-info">
                  <strong><%= order.user.name %></strong> (<%= order.user.email %>)
                </span>
                <span class="order-date">
                  <%= order.created_at.strftime("%B %d, %Y at %I:%M %p") %>
                </span>
                <span class="order-status <%= order.status %>">
                  <%= order.status.capitalize %>
                </span>
              </div>
            </div>
            <div class="order-actions">
              <% if order.completed? %>
                <%= button_to toggle_order_status_path(order), method: :patch, class: "btn btn-success status-btn", title: "Mark as pending" do %>
                  <i class="fas fa-check"></i> Completed
                <% end %>
              <% else %>
                <%= button_to toggle_order_status_path(order), method: :patch, class: "btn btn-warning status-btn", title: "Mark as completed" do %>
                  Complete
                <% end %>
              <% end %>
            </div>
          </div>
          
          <div class="order-items">
            <% order.order_items.each do |order_item| %>
              <div class="order-product">
                <div class="product-image">
                  <img src="<%= order_item.product.image %>" alt="<%= order_item.product.name %>">
                </div>
                <div class="product-details">
                  <h4><%= order_item.product.name %></h4>
                  <p class="product-price">$<%= number_with_precision(order_item.price_at_time, precision: 2) %></p>
                  <p class="product-quantity">Quantity: <%= order_item.quantity %></p>
                  <p class="product-subtotal">Subtotal: $<%= number_with_precision(order_item.price_at_time * order_item.quantity, precision: 2) %></p>
                </div>
              </div>
            <% end %>
          </div>
          
          <div class="order-footer">
            <div class="order-total">
              <h4>Total: $<%= number_with_precision(order.total_amount, precision: 2) %></h4>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="empty-orders">
      <h2>No orders found</h2>
      <p>Orders will appear here once customers place them.</p>
    </div>
  <% end %>
</div> 
